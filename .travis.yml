language: nix

nix: 2.2.2

script:
  - nix-env -iA cachix -f https://cachix.org/api/v1/install
  - cachix use werbematerial-gh-pages
  - if [ -n "$CACHIX_SIGNING_KEY" ]; then cachix push werbematerial-gh-pages --watch-store; fi &
  - nix-build --argstr public-url '/werbematerial'
  - sleep 10 # give cachix time to upload artifacts

deploy:
  provider: pages
  skip-cleanup: true
  local-dir: result/
  github-token: $GITHUB_TOKEN
  keep-history: true
  on:
    branch: master
